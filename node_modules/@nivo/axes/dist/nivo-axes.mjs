import*as t from"react";import{memo as e,useMemo as n,useCallback as i,createElement as r}from"react";import{textPropsByEngine as a,useMotionConfig as o,degreesToRadians as l}from"@nivo/core";import{useTheme as c,useExtendedAxisTheme as s,extendAxisTheme as f}from"@nivo/theming";import{Text as u,setCanvasFont as d,drawCanvasText as x}from"@nivo/text";import{animated as m,useSpring as y,useTransition as v}from"@react-spring/web";import{timeFormat as g}from"d3-time-format";import{format as h}from"d3-format";import{getScaleTicks as k,centerScale as p}from"@nivo/scales";import{jsxs as b,jsx as P,Fragment as A}from"react/jsx-runtime";function T(){return T=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},T.apply(null,arguments)}var S=function(t){var e,n=t.axis,i=t.scale,r=t.ticksPosition,o=t.tickValues,l=t.tickSize,c=t.tickPadding,s=t.tickRotation,f=t.truncateTickAt,u=t.engine,d=void 0===u?"svg":u,x=k(i,o),m=a[d],y="bandwidth"in i?p(i):i,v={lineX:0,lineY:0},g={textX:0,textY:0},h="object"==typeof document&&"rtl"===document.dir,b=m.align.center,P=m.baseline.center;"x"===n?(e=function(t){var e;return{x:null!=(e=y(t))?e:0,y:0}},v.lineY=l*("after"===r?1:-1),g.textY=(l+c)*("after"===r?1:-1),P="after"===r?m.baseline.top:m.baseline.bottom,0===s?b=m.align.center:"after"===r&&s<0||"before"===r&&s>0?(b=m.align[h?"left":"right"],P=m.baseline.center):("after"===r&&s>0||"before"===r&&s<0)&&(b=m.align[h?"right":"left"],P=m.baseline.center)):(e=function(t){var e;return{x:0,y:null!=(e=y(t))?e:0}},v.lineX=l*("after"===r?1:-1),g.textX=(l+c)*("after"===r?1:-1),b="after"===r?m.align.left:m.align.right);return{ticks:x.map((function(t){var n="string"==typeof t?function(t){var e=String(t).length;return f&&f>0&&e>f?""+String(t).slice(0,f).concat("..."):""+t}(t):t;return T({key:t instanceof Date?""+t.valueOf():""+t,value:n},e(t),v,g)})),textAlign:b,textBaseline:P}},w=function(t,e){if(void 0===t||"function"==typeof t)return t;if("time"===e.type){var n=g(t);return function(t){return n(t instanceof Date?t:new Date(t))}}return h(t)},X=function(t){var e,n=t.width,i=t.height,r=t.scale,a=t.axis,o=t.values,l=(e=o,Array.isArray(e)?o:void 0)||k(r,o),c="bandwidth"in r?p(r):r,s="x"===a?l.map((function(t){var e,n;return{key:t instanceof Date?""+t.valueOf():""+t,x1:null!=(e=c(t))?e:0,x2:null!=(n=c(t))?n:0,y1:0,y2:i}})):l.map((function(t){var e,i;return{key:t instanceof Date?""+t.valueOf():""+t,x1:0,x2:n,y1:null!=(e=c(t))?e:0,y2:null!=(i=c(t))?i:0}}));return s},Y=e((function(t){var e,i=t.value,r=t.format,a=t.lineX,o=t.lineY,l=t.onClick,c=t.textBaseline,s=t.textAnchor,f=t.theme,d=t.animatedProps,x=null!=(e=null==r?void 0:r(i))?e:i,y=n((function(){var t={opacity:d.opacity};return l?{style:T({},t,{cursor:"pointer"}),onClick:function(t){return l(t,x)}}:{style:t}}),[d.opacity,l,x]);return b(m.g,T({transform:d.transform},y,{children:[P("line",{x1:0,x2:a,y1:0,y2:o,style:f.line}),P(u,{dominantBaseline:c,textAnchor:s,transform:d.textTransform,style:f.text,children:""+x})]}))})),B=function(e){var r=e.axis,a=e.scale,l=e.x,f=void 0===l?0:l,d=e.y,x=void 0===d?0:d,g=e.length,h=e.ticksPosition,k=e.tickValues,p=e.tickSize,X=void 0===p?5:p,B=e.tickPadding,O=void 0===B?5:B,V=e.tickRotation,C=void 0===V?0:V,z=e.format,D=e.renderTick,R=void 0===D?Y:D,j=e.truncateTickAt,E=e.legend,W=e.legendPosition,q=void 0===W?"end":W,H=e.legendOffset,I=void 0===H?0:H,F=e.style,G=e.onClick,J=e.ariaHidden,K=c(),L=s(K.axis,F),M=n((function(){return w(z,a)}),[z,a]),N=S({axis:r,scale:a,ticksPosition:h,tickValues:k,tickSize:X,tickPadding:O,tickRotation:C,truncateTickAt:j}),Q=N.ticks,U=N.textAlign,Z=N.textBaseline,$=null;if(void 0!==E){var _,tt=0,et=0,nt=0;"y"===r?(nt=-90,tt=I,"start"===q?(_="start",et=g):"middle"===q?(_="middle",et=g/2):"end"===q&&(_="end")):(et=I,"start"===q?_="start":"middle"===q?(_="middle",tt=g/2):"end"===q&&(_="end",tt=g)),$=P(A,{children:P(u,{transform:"translate("+tt+", "+et+") rotate("+nt+")",textAnchor:_,style:T({},L.legend.text,{dominantBaseline:"central"}),children:E})})}var it=o(),rt=it.animate,at=it.config,ot=y({transform:"translate("+f+","+x+")",lineX2:"x"===r?g:0,lineY2:"x"===r?0:g,config:at,immediate:!rt}),lt=i((function(t){return{opacity:1,transform:"translate("+t.x+","+t.y+")",textTransform:"translate("+t.textX+","+t.textY+") rotate("+C+")"}}),[C]),ct=i((function(t){return{opacity:0,transform:"translate("+t.x+","+t.y+")",textTransform:"translate("+t.textX+","+t.textY+") rotate("+C+")"}}),[C]),st=v(Q,{keys:function(t){return t.key},initial:lt,from:ct,enter:lt,update:lt,leave:{opacity:0},config:at,immediate:!rt});return b(m.g,{transform:ot.transform,"aria-hidden":J,children:[st((function(e,n,i,r){return t.createElement(R,T({tickIndex:r,format:M,rotate:C,textBaseline:Z,textAnchor:U,truncateTickAt:j,animatedProps:e,theme:L.ticks},n,G?{onClick:G}:{}))})),P(m.line,{style:L.domain.line,x1:0,x2:ot.lineX2,y1:0,y2:ot.lineY2}),$]})},O=e(B),V=["top","right","bottom","left"],C=e((function(t){var e=t.xScale,n=t.yScale,i=t.width,r=t.height,a={top:t.top,right:t.right,bottom:t.bottom,left:t.left};return P(A,{children:V.map((function(t){var o=a[t];if(!o)return null;var l="top"===t||"bottom"===t;return P(O,T({},o,{axis:l?"x":"y",x:"right"===t?i:0,y:"bottom"===t?r:0,scale:l?e:n,length:l?i:r,ticksPosition:"top"===t||"left"===t?"before":"after",truncateTickAt:o.truncateTickAt}),t)}))})})),z=e((function(t){var e=t.animatedProps,n=c();return P(m.line,T({},e,n.grid.line))})),D=e((function(t){var e=t.lines,n=o(),i=n.animate,a=n.config,l=v(e,{keys:function(t){return t.key},initial:function(t){return{opacity:1,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2}},from:function(t){return{opacity:0,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2}},enter:function(t){return{opacity:1,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2}},update:function(t){return{opacity:1,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2}},leave:{opacity:0},config:a,immediate:!i});return P("g",{children:l((function(t,e){return r(z,T({},e,{key:e.key,animatedProps:t}))}))})})),R=e((function(t){var e=t.width,i=t.height,r=t.xScale,a=t.yScale,o=t.xValues,l=t.yValues,c=n((function(){return!!r&&X({width:e,height:i,scale:r,axis:"x",values:o})}),[r,o,e,i]),s=n((function(){return!!a&&X({width:e,height:i,scale:a,axis:"y",values:l})}),[i,e,a,l]);return b(A,{children:[c&&P(D,{lines:c}),s&&P(D,{lines:s})]})})),j=function(t,e){var n,i,r=e.axis,a=e.scale,o=e.x,c=void 0===o?0:o,s=e.y,u=void 0===s?0:s,m=e.length,y=e.ticksPosition,v=e.tickValues,g=e.tickSize,h=void 0===g?5:g,k=e.tickPadding,p=void 0===k?5:k,b=e.tickRotation,P=void 0===b?0:b,A=e.format,T=e.legend,w=e.legendPosition,X=void 0===w?"end":w,Y=e.legendOffset,B=void 0===Y?0:Y,O=e.theme,V=e.style,C=S({axis:r,scale:a,ticksPosition:y,tickValues:v,tickSize:h,tickPadding:p,tickRotation:P,engine:"canvas"}),z=C.ticks,D=C.textAlign,R=C.textBaseline;t.save(),t.translate(c,u);var j=f(O.axis,V);t.textAlign=D,t.textBaseline=R,d(t,j.ticks.text);var E=null!=(n=j.domain.line.strokeWidth)?n:0;"string"!=typeof E&&E>0&&(t.lineWidth=E,t.lineCap="square",j.domain.line.stroke&&(t.strokeStyle=j.domain.line.stroke),t.beginPath(),t.moveTo(0,0),t.lineTo("x"===r?m:0,"x"===r?0:m),t.stroke());var W="function"==typeof A?A:function(t){return""+t},q=null!=(i=j.ticks.line.strokeWidth)?i:0,H="string"!=typeof q&&q>0;if(z.forEach((function(e){H&&(t.lineWidth=q,t.lineCap="square",j.ticks.line.stroke&&(t.strokeStyle=j.ticks.line.stroke),t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x+e.lineX,e.y+e.lineY),t.stroke());var n=W(e.value);t.save(),t.translate(e.x+e.textX,e.y+e.textY),t.rotate(l(P)),x(t,j.ticks.text,""+n),t.fillText(""+n,0,0),t.restore()})),void 0!==T){var I=0,F=0,G=0,J="center";"y"===r?(G=-90,I=B,"start"===X?(J="start",F=m):"middle"===X?(J="center",F=m/2):"end"===X&&(J="end")):(F=B,"start"===X?J="start":"middle"===X?(J="center",I=m/2):"end"===X&&(J="end",I=m)),t.translate(I,F),t.rotate(l(G)),d(t,j.legend.text),j.legend.text.fill&&(t.fillStyle=j.legend.text.fill),t.textAlign=J,t.textBaseline="middle",x(t,j.legend.text,T)}t.restore()},E=function(t,e){var n=e.xScale,i=e.yScale,r=e.width,a=e.height,o=e.top,l=e.right,c=e.bottom,s=e.left,f=e.theme,u={top:o,right:l,bottom:c,left:s};V.forEach((function(e){var o=u[e];if(!o)return null;var l="top"===e||"bottom"===e,c="top"===e||"left"===e?"before":"after",s=l?n:i,d=w(o.format,s);j(t,T({},o,{axis:l?"x":"y",x:"right"===e?r:0,y:"bottom"===e?a:0,scale:s,format:d,length:l?r:a,ticksPosition:c,theme:f}))}))},W=function(t,e){var n=e.width,i=e.height,r=e.scale,a=e.axis,o=e.values;X({width:n,height:i,scale:r,axis:a,values:o}).forEach((function(e){t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.stroke()}))};export{C as Axes,O as Axis,Y as AxisTick,R as Grid,z as GridLine,D as GridLines,B as NonMemoizedAxis,V as positions,E as renderAxesToCanvas,j as renderAxisToCanvas,W as renderGridLinesToCanvas};
//# sourceMappingURL=nivo-axes.mjs.map
